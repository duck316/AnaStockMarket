<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <title>Subir CSV</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body class="container mt-5">

<h2>Subir archivo CSV</h2>

<input
  type="file"
  id="csvFile"
  accept=".csv,text/csv"
  class="form-control mb-2"
>

<button class="btn btn-primary" onclick="uploadCSV()">Subir</button>

<script>
function uploadCSV() {
    const fileInput = document.getElementById("csvFile");
    if (!fileInput.files.length) {
        alert("Selecciona un archivo CSV");
        return;
    }

    const formData = new FormData();
    formData.append("file", fileInput.files[0]);

    fetch("/", {
        method: "POST",
        body: formData
    })
    .then(res => res.text())
    .then(html => {
        document.open();
        document.write(html);
        document.close();
    })
    .catch(err => {
        alert("Error al subir archivo");
        console.error(err);
    });
}
</script>

{% if ranking %}
<h3 class="mt-5">üèÜ Top 10 Ranking Visual</h3>

{% for row in ranking %}
<div class="mb-2">
    <strong>{{ loop.index }}. {{ row["Symbol"] }}</strong>
    <div class="progress">
        <div class="progress-bar bg-success"
             role="progressbar"
             style="width: {{ row['Score_norm'] }}%">
            {{ row['Score_norm'] | round(1) }}%
        </div>
    </div>
</div>
{% endfor %}
{% endif %}

{% if table %}
<h3>Contenido del CSV</h3>
<div class="table-responsive">
    {{ table | safe }}
</div>
{% endif %}

</body>
</html>

